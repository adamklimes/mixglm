<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Case Study • mixglm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case Study">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mixglm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mixglm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/caseStudy.html">Case Study</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Case Study</h1>
            <h3 data-toc-skip class="subtitle">Contents</h3>
            
      

      <div class="d-none name"><code>caseStudy.Rmd</code></div>
    </div>

    
    
<p>This is an article illustrating the use of <em>mixglm</em> package on
a case study. For a more technical illustration of the package
functionality, see <code><a href="../articles/mixglm.html">vignette("mixglm")</a></code> (<em>mixglm</em> has
to be installed with vignettes).<br><br></p>
<div class="section level2">
<h2 id="tree-cover-in-south-america">Tree cover in South America<a class="anchor" aria-label="anchor" href="#tree-cover-in-south-america"></a>
</h2>
<p>The case study replicates analyses by Hirota et
al. (<a name="bHirota"></a><a href="#refHirota">2011</a>) and Flores et
al. (<a name="bFlores"></a><a href="#refFlores">2024</a>). These two
studies model tree cover for most of South America and for the Amazon
respectively along a precipitation gradient. The used tree cover data is
from 2001. Replication of the analysis here is done using tree cover for
the year 2025 for the whole of South America.<br><br></p>
<div class="section level3">
<h3 id="tree-cover-dataset">Tree cover dataset<a class="anchor" aria-label="anchor" href="#tree-cover-dataset"></a>
</h3>
<p><em>mixglm</em> package provides the dataset <code>treeCover</code>
which includes tree cover, precipitation, temperature, and predicted
precipitation for the end of 21st century and coordinates for 5,000
data-points across South America.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mixglm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nimble</span></span>
<span><span class="co">#&gt; nimble version 1.3.0 is loaded.</span></span>
<span><span class="co">#&gt; For more information on NIMBLE and a User Manual,</span></span>
<span><span class="co">#&gt; please visit https://R-nimble.org.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note for advanced users who have written their own MCMC samplers:</span></span>
<span><span class="co">#&gt;   As of version 0.13.0, NIMBLE's protocol for handling posterior</span></span>
<span><span class="co">#&gt;   predictive nodes has changed in a way that could affect user-defined</span></span>
<span><span class="co">#&gt;   samplers in some situations. Please see Section 15.5.1 of the User Manual.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nimble'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     simulate</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     declare</span></span>
<span></span>
<span><span class="co"># See ?treeCover for additional information </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">treeCover</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    5000 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ x         : num  -47.7 -70.5 -61 -54.7 -69.8 ...</span></span>
<span><span class="co">#&gt;  $ y         : num  -24.47 -14.57 -10 2.97 -18.56 ...</span></span>
<span><span class="co">#&gt;  $ treeCover : num  74.51 5.44 79.71 68.72 1.42 ...</span></span>
<span><span class="co">#&gt;  $ precip    : num  1917 1272 2096 2514 242 ...</span></span>
<span><span class="co">#&gt;  $ temp      : num  22.21 6.67 25.58 25.88 15.45 ...</span></span>
<span><span class="co">#&gt;  $ precip2100: num  1627 1317 1580 1544 876 ...</span></span></code></pre></div>
<p>In this case study, we model the stability landscape for tropical
forests and savanna alternative states along precipitation and
temperature gradients. There are only a few observations with very high
precipitation and very low temperature. This prevents us from estimating
reliably the stability landscape for these parts of respective
gradients. Therefore, we constrain the analyses to the well-represented
parts of precipitation (below 4000 mm/yr) and temperature gradients
(over 0°C).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">treeCover</span><span class="op">$</span><span class="va">treeCover</span> <span class="op">~</span> <span class="va">treeCover</span><span class="op">$</span><span class="va">precip</span>, cex <span class="op">=</span> <span class="fl">0.1</span>, ylab <span class="op">=</span> <span class="st">"Tree cover (%)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Precipitation (mm/yr)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">4000</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/dataSelection-1.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">treeCover</span><span class="op">$</span><span class="va">treeCover</span> <span class="op">~</span> <span class="va">treeCover</span><span class="op">$</span><span class="va">temp</span>, cex <span class="op">=</span> <span class="fl">0.1</span>, ylab <span class="op">=</span> <span class="st">"Tree cover (%)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/dataSelection-2.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datTC</span> <span class="op">&lt;-</span> <span class="va">treeCover</span><span class="op">[</span><span class="va">treeCover</span><span class="op">$</span><span class="va">precip</span> <span class="op">&lt;</span> <span class="fl">4000</span> <span class="op">&amp;</span> <span class="va">treeCover</span><span class="op">$</span><span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span> <span class="co"># 4860 observations</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stability-landscape-along-precipitation-gradient">Stability landscape along precipitation gradient<a class="anchor" aria-label="anchor" href="#stability-landscape-along-precipitation-gradient"></a>
</h3>
<p>First, we model the stability landscape along the precipitation
gradient. Tree cover has an upper (100%) as well as lower (0%) limit,
therefore we will use a beta mixture rather than a Gaussian (normal). A
beta-distributed variable can have values from 0 to 1 (excluding 0 and
1). Thus, we calculate the proportion of tree cover and shift the values
slightly to make sure the dataset does not contain any exact zeros or
ones. We also standardize predictors to 0 mean and standard deviation 1
to facilitate the model fit (and ensure the same effect of priors once
we use multiple predictors).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">squeeze</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">0.98</span> <span class="op">+</span> <span class="fl">0.01</span></span>
<span><span class="va">datTC</span><span class="op">$</span><span class="va">treeCoverProp</span> <span class="op">&lt;-</span> <span class="fu">squeeze</span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">treeCover</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">datTC</span><span class="op">$</span><span class="va">precipSt</span> <span class="op">&lt;-</span> <span class="fu">st</span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">precip</span><span class="op">)</span></span>
<span><span class="va">datTC</span><span class="op">$</span><span class="va">tempSt</span> <span class="op">&lt;-</span> <span class="fu">st</span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p>We need to specify the number of components in the mixture. We should
use more components than is the number of expected stable states because
each stable state can be modeled using multiple components (resulting
e.g. in a wider basin). Since the probability of each component in the
mixture is estimated, unnecessary components will have a probability
close to zero and will be effectively suppressed. We could select the
number of components based on an Watanabe-Akaike information criterion
(WAIC; <a name="bWatanabe"></a><a href="#refWatanabe">Watanabe,
2013</a>) by running the model with different numbers of components and
selecting the one with the lowest WAIC. However, estimates of WAIC are
sometimes unstable for mixture models. In conclusion, we recommend using
a high number of components and ensure that results are not affected by
adding or excluding a component. In this example, we use 7 components.
We also limit the number of chains to just 2 (for illustration purposes)
to make the fit quicker (the following model fit can take up to a few
hours).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numStates</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">modP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixglm.html">mixglm</a></span><span class="op">(</span></span>
<span>  stateValModels <span class="op">=</span> <span class="va">treeCoverProp</span> <span class="op">~</span> <span class="va">precipSt</span>,</span>
<span>  stateProbModels <span class="op">=</span> <span class="op">~</span> <span class="va">precipSt</span>,</span>
<span>  statePrecModels <span class="op">=</span> <span class="op">~</span> <span class="va">precipSt</span>,</span>
<span>  stateValError <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>  inputData <span class="op">=</span> <span class="va">datTC</span>,</span>
<span>  numStates <span class="op">=</span> <span class="va">numStates</span>,</span>
<span>  mcmcChains <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="exploration-of-results">Exploration of results<a class="anchor" aria-label="anchor" href="#exploration-of-results"></a>
</h4>
<p>To explore the results, we begin by plotting individual components.
It shows us how they fit the data and by using the default argument
<code>byChains = TRUE</code>, we can see if chains did not converge
well. For example, below we can see double lines for some mixture
components showing that the convergence was not perfect in this case.
For further discussion of convergence and how to assess it, see
<code><a href="../articles/mixglm.html">vignette("mixglm")</a></code>.<br><br>
Upper part of the figure shows the probability of each component along
the precipitation gradient. The lower part depicts mean and standard
deviation for each component along the same gradient.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modP</span>, cex <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/plot-1.png" width="672"></p>
<p>To obtain the overall stability landscape, we use the
<code><a href="../reference/landscapeMixglm.html">landscapeMixglm()</a></code> function. By default, it shows stable
states in blue and tipping points in red with scaled probability density
as a background. Small “bumps” in the stability landscape are unlikely
to denote real stable states. To avoid them, we set the
<code>threshold</code> value to be higher than zero.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modP</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/landscape-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Threshold = 0.1 and original precipitation values (x-axis)</span></span>
<span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modP</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, xlab <span class="op">=</span> <span class="st">"Precipitation (mm/yr)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Tree cover (%)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">*</span><span class="fl">20</span>, at <span class="op">=</span> <span class="fu">squeeze</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span>, at <span class="op">=</span> <span class="fu">st</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">precip</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/landscape-2.png" width="672"></p>
<p>The same function can be used to visualize uncertainty by plotting
the stability landscape based on random posterior samples. The
background shows the standard deviation of these landscapes. Since the
plotting can be slow with a higher number of samples, we use only 5
here.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modP</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, randomSample <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/uncertainty-1.png" width="672"></p>
<p>We can explore the stability curves for any precipitation value using
the <code><a href="../reference/sliceMixglm.html">sliceMixglm()</a></code> function. Since we used standardized
precipitation as a predictor, we need to standardize the precipitation
value for which we want the stability curve. In addition to the
stability curve, the figure also shows estimates of each component at
the specified precipitation value.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sliceMixglm.html">sliceMixglm</a></span><span class="op">(</span><span class="va">modP</span>, value <span class="op">=</span> <span class="fu">st</span><span class="op">(</span><span class="fl">2000</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">precip</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/slice-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="maps-of-domains-and-resilience">Maps of domains and resilience<a class="anchor" aria-label="anchor" href="#maps-of-domains-and-resilience"></a>
</h4>
<p>Since the stability landscape can be complex, with theoretically many
stable states, there is no general way to assign observations to domains
of individual stable states. In this case study, however, it is
relatively simple since we identified two clearly distinct stable
states. First, we use the function <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> to obtain the
stable states and tipping points for all modeled observations (along
with resilience measures which we will use later). The function
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> calculates the stability curve for each
observation (modeled or provided as a <code>newdata</code>) and returns
its stable states (<code>state == 1</code>) and tipping points with
scaled probability density, response variable value
(<code>treeCoverProp</code>), and whether they satisfy the threshold
(<code>catSt == 1</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">modP</span>, threshold <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># Stable states and tipping points for observation 3</span></span>
<span><span class="va">tipStable3</span> <span class="op">&lt;-</span> <span class="va">pred</span><span class="op">$</span><span class="va">tipStable</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">tipStable3</span></span>
<span><span class="co">#&gt;    probDens      resp state catSt</span></span>
<span><span class="co">#&gt; 3 0.4098253 0.2162848     1     1</span></span>
<span><span class="co">#&gt; 1 0.1521568 0.4597204     0     1</span></span>
<span><span class="co">#&gt; 4 0.2650052 0.6699158     1     0</span></span>
<span><span class="co">#&gt; 2 0.2642923 0.6933795     0     0</span></span>
<span><span class="co">#&gt; 5 1.0000000 0.7813682     1     1</span></span>
<span></span>
<span><span class="co"># Stability curve for observation 3 with stable states (blue) and </span></span>
<span><span class="co">#   tipping points (red) (full circles when they satisfy the threshold)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">probCurves</span><span class="op">$</span><span class="va">X3</span> <span class="op">~</span> <span class="va">pred</span><span class="op">$</span><span class="va">sampledResp</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"treeCoverProp"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Probability density (scaled)"</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">tipStable3</span><span class="op">$</span><span class="va">resp</span>, <span class="va">tipStable3</span><span class="op">$</span><span class="va">probDens</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">tipStable3</span><span class="op">$</span><span class="va">state</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span><span class="op">[</span><span class="va">tipStable3</span><span class="op">$</span><span class="va">catSt</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/domains-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># A function to determine the domain (for this case study!)</span></span>
<span><span class="va">isDomainForest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tipStable</span>, <span class="va">resp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Extract response of stable states/tipping points which satisfy the threshold</span></span>
<span>  <span class="va">stateResp</span> <span class="op">&lt;-</span> <span class="va">tipStable</span><span class="op">$</span><span class="va">resp</span><span class="op">[</span><span class="va">tipStable</span><span class="op">$</span><span class="va">state</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">tipStable</span><span class="op">$</span><span class="va">catSt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">tipResp</span> <span class="op">&lt;-</span> <span class="va">tipStable</span><span class="op">$</span><span class="va">resp</span><span class="op">[</span><span class="va">tipStable</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">tipStable</span><span class="op">$</span><span class="va">catSt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">stateResp</span> <span class="op">&lt;-</span> <span class="va">stateResp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stateResp</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">tipResp</span> <span class="op">&lt;-</span> <span class="va">tipResp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tipResp</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># Auxiliary function to provide minimum of x or Inf if x has length 0</span></span>
<span>  <span class="va">minE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="cn">Inf</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="co"># Response value of domain's stable state</span></span>
<span>  <span class="va">domainStateResp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stateResp</span><span class="op">[</span><span class="va">stateResp</span> <span class="op">&lt;=</span> <span class="va">resp</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">resp</span> <span class="op">-</span> <span class="va">stateResp</span> <span class="op">&lt;</span> <span class="fu">minE</span><span class="op">(</span><span class="op">(</span><span class="va">resp</span> <span class="op">-</span> <span class="va">tipResp</span><span class="op">)</span><span class="op">[</span><span class="va">resp</span> <span class="op">-</span> <span class="va">tipResp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">stateResp</span><span class="op">[</span><span class="va">stateResp</span> <span class="op">&gt;</span> <span class="va">resp</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">stateResp</span> <span class="op">-</span> <span class="va">resp</span> <span class="op">&lt;</span> <span class="fu">minE</span><span class="op">(</span><span class="op">(</span><span class="va">tipResp</span> <span class="op">-</span> <span class="va">resp</span><span class="op">)</span><span class="op">[</span><span class="va">tipResp</span> <span class="op">-</span> <span class="va">resp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">domainStateResp</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="cn">NA</span> <span class="kw">else</span></span>
<span>    <span class="co"># Domain with response value of stable state above 0.6 is always forest</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">domainStateResp</span> <span class="op">&gt;</span> <span class="fl">0.6</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span><span class="op">}</span></span>
<span><span class="va">domainForest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">isDomainForest</span>, <span class="va">pred</span><span class="op">$</span><span class="va">tipStable</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCoverProp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visual check</span></span>
<span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modP</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, addPoints <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">precipSt</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCoverProp</span>, </span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">[</span><span class="va">domainForest</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/domains-2.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Map of domains</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">[</span><span class="va">domainForest</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, </span>
<span>  pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/domains-3.png" width="672"></p>
<p>The function <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> can be also used for prediction
by specifying the argument <code>newdata</code>. For example, we can
predict domains for precipitation at the end of 21st century:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Future precipitation is used for domain prediction which is forest for all </span></span>
<span><span class="co">#  values over 4000</span></span>
<span><span class="va">datTC</span><span class="op">$</span><span class="va">precip2100</span><span class="op">[</span><span class="va">datTC</span><span class="op">$</span><span class="va">precip2100</span> <span class="op">&gt;</span> <span class="fl">4000</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4000</span></span>
<span></span>
<span><span class="va">predF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">modP</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>precipSt <span class="op">=</span> <span class="fu">st</span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">precip2100</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">precip</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">domainForestF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">isDomainForest</span>, <span class="va">predF</span><span class="op">$</span><span class="va">tipStable</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCoverProp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map of predicted domains</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">[</span><span class="va">domainForestF</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, </span>
<span>  pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/predict-1.png" width="672"></p>
<p>We can similarly plot various resilience measures stored in
<code>pred$obsDat</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A function to assign colors to a continuous measure</span></span>
<span><span class="va">assignColor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">sq</span>, all.inside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Map of resilience (potential depth)</span></span>
<span><span class="va">potentialDepthCol</span> <span class="op">&lt;-</span> <span class="fu">assignColor</span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">obsDat</span><span class="op">$</span><span class="va">potentialDepth</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"grey"</span>, pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, </span>
<span>  ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="va">potentialDepthCol</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/resilience-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="stability-landscape-with-multiple-predictors">Stability landscape with multiple predictors<a class="anchor" aria-label="anchor" href="#stability-landscape-with-multiple-predictors"></a>
</h3>
<p>Package <em>mixglm</em> allows for specification of multiple
predictors for each mixture component (and also for mean, precision, and
probability). This is desirable because relevant external conditions
(such as climate) cannot be often captured using a single predictor. The
downside is that it increases dimensionality of the model which then
cannot be easily visualized in 2D. To illustrate <em>mixglm</em> model
with multiple predictors, we add temperature as a predictor to our case
study of tree cover in South America.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">modPT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixglm.html">mixglm</a></span><span class="op">(</span></span>
<span>  stateValModels <span class="op">=</span> <span class="va">treeCoverProp</span> <span class="op">~</span> <span class="va">precipSt</span> <span class="op">+</span> <span class="va">tempSt</span>,</span>
<span>  stateProbModels <span class="op">=</span> <span class="op">~</span> <span class="va">precipSt</span> <span class="op">+</span> <span class="va">tempSt</span>,</span>
<span>  statePrecModels <span class="op">=</span> <span class="op">~</span> <span class="va">precipSt</span> <span class="op">+</span> <span class="va">tempSt</span>,</span>
<span>  stateValError <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>  inputData <span class="op">=</span> <span class="va">datTC</span>,</span>
<span>  numStates <span class="op">=</span> <span class="va">numStates</span>,</span>
<span>  mcmcChains <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can still use the 2D visualization functions <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
and <code><a href="../reference/landscapeMixglm.html">landscapeMixglm()</a></code>. However, they show us only one
gradient, with either the other predictor fixed to zero or (in the case
of <code><a href="../reference/landscapeMixglm.html">landscapeMixglm()</a></code>) a specified value. Therefore, fit of
lines to observations can be misleading. Keep in mind that we see just
one cross-section of the stability landscape.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fitted mixture components along temperature gradient (for precipSt == 0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modPT</span>, form <span class="op">=</span> <span class="va">treeCoverProp</span> <span class="op">~</span> <span class="va">tempSt</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/plot2D-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Stability landscape along temperature gradient (for precipSt == 0)</span></span>
<span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modPT</span>, <span class="va">treeCoverProp</span> <span class="op">~</span> <span class="va">tempSt</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, addPoints <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/plot2D-2.png" width="672"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Stability lanscape along precipitation gradient (for temperature 20°C)</span></span>
<span><span class="fu"><a href="../reference/landscapeMixglm.html">landscapeMixglm</a></span><span class="op">(</span><span class="va">modPT</span>, <span class="va">treeCoverProp</span> <span class="op">~</span> <span class="va">precipSt</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  otherPreds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">st</span><span class="op">(</span><span class="fl">20</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span>, <span class="st">"tempSt"</span><span class="op">)</span>, addPoints <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/plot2D-3.png" width="672"></p>
<p>While visualization of the stability landscape is limited, stability
curves and resilience measures can be calculated for each observation
(accounting for all predictors). For that, we use function
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predPT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">modPT</span>, threshold <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stability curve for observation 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">sampledResp</span>, <span class="va">predPT</span><span class="op">$</span><span class="va">probCurves</span><span class="op">$</span><span class="va">X1</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/curves-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Stable states for each observation</span></span>
<span><span class="va">stableStates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">tipStable</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">resp</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">state</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">catSt</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Number of stable state</span></span>
<span><span class="va">nStableStates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">stableStates</span>, <span class="va">length</span>, FUN.VALUE <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nStableStates</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># Observations with alternative stable states (red)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">precip</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">temp</span>, xlab <span class="op">=</span> <span class="st">"Precipitation (mm/yr)"</span>, ylab <span class="op">=</span> <span class="st">"Temperature (°C)"</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">nStableStates</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/curves-2.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">precip</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCover</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">nStableStates</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/curves-3.png" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">temp</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCover</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">[</span><span class="va">nStableStates</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/curves-4.png" width="672"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Map of resilience (potential depth)</span></span>
<span><span class="va">potentialDepthPTCol</span> <span class="op">&lt;-</span> <span class="fu">assignColor</span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">obsDat</span><span class="op">$</span><span class="va">potentialDepth</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"grey"</span>, pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, </span>
<span>  ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="va">potentialDepthPTCol</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/curves-5.png" width="672"></p>
<div class="section level4">
<h4 id="correlation-of-predictors">Correlation of predictors<a class="anchor" aria-label="anchor" href="#correlation-of-predictors"></a>
</h4>
<p>In this case study the predictors are not highly correlated (Pearson
correlation coefficient is 0.46). However, in many ecological studies,
high correlation among potential predictors is common. We can expect
<em>mixglm</em> to behave similarly to other regression models when used
with correlated predictors. Estimates of their effects will not be
reliable, MCMC chains might not converge well unless regularized using
informative priors. The overall stability landscape would be affected
less than, for example, predictions for new data, which would be
unreliable. Generally, we recommend avoiding highly correlated
predictors when possible (or making sure that the results are not
affected by this correlation).</p>
</div>
<div class="section level4">
<h4 id="absence-of-alternative-stable-states">Absence of alternative stable states<a class="anchor" aria-label="anchor" href="#absence-of-alternative-stable-states"></a>
</h4>
<p>In a large part of South America, we have not found any alternative
stable states along precipitation and temperature gradients. This will
be the case for many systems with some having only one stable state of
its ecosystem state variable along the whole predictor gradient.
Although some measures of resilience are not defined for these areas or
cases (for example, distance to the closest tipping point),
<em>mixglm</em> provides other measures of ecological resilience which
can be computed and thus used to characterize the state of the
ecosystem.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map of resilience (distance to stable state)</span></span>
<span><span class="va">distStatePTCol</span> <span class="op">&lt;-</span> <span class="fu">assignColor</span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">obsDat</span><span class="op">$</span><span class="va">distToState</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># High distance to state is red</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"grey"</span>, pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, </span>
<span>  ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="va">distStatePTCol</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/oneState-1.png" width="672"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Stable state tree cover </span></span>
<span><span class="va">stateResp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">tipStable</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">resp</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">state</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">catSt</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tipResp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">predPT</span><span class="op">$</span><span class="va">tipStable</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>  <span class="op">{</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">resp</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">catSt</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span>; <span class="va">out</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Function to select the state in which domain is the observation (from 2 states)</span></span>
<span><span class="va">getState</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">tip</span>, <span class="va">resp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">stateDist</span> <span class="op">&lt;-</span> <span class="va">state</span> <span class="op">-</span> <span class="va">resp</span></span>
<span>  <span class="va">signState</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">stateDist</span><span class="op">)</span></span>
<span>  <span class="va">signTip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">tip</span> <span class="op">-</span> <span class="va">resp</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">signState</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">signState</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">signState</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="va">state</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">stateDist</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">stateDist</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="kw">else</span> <span class="va">state</span><span class="op">[</span><span class="va">signState</span> <span class="op">!=</span> <span class="va">signTip</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">stateRespObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">getState</span>, <span class="va">stateResp</span>, <span class="va">tipResp</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">treeCoverProp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map of stable state tree cover</span></span>
<span><span class="va">statePTCol</span> <span class="op">&lt;-</span> <span class="fu">assignColor</span><span class="op">(</span><span class="va">stateRespObs</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># High tree cover is green</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">datTC</span><span class="op">$</span><span class="va">x</span>, <span class="va">datTC</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="va">statePTCol</span>, pch <span class="op">=</span> <span class="fl">15</span>, xlab <span class="op">=</span> <span class="st">"Longitude (°)"</span>, </span>
<span>  ylab <span class="op">=</span> <span class="st">"Latitude (°)"</span>, asp <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy_files/figure-html/oneState-2.png" width="672"></p>
<p><br></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><a href="#bFlores">↑</a> <a name="refFlores"></a>Flores, B.M.,
Montoya, E., Sakschewski, B. et al. 2024. Critical transitions in the
Amazon forest system. <em>Nature</em> 626, 555–564. <a href="https://doi.org/10.1038/s41586-023-06970-0" class="external-link">doi.org/10.1038/s41586-023-06970-0</a><br><br><a href="#bHirota">↑</a> <a name="refHirota"></a>Hirota, M., M.
Holmgren, E. H. van Nes, and M. Scheffer. 2011. Global resilience of
tropical forest and savanna to critical transitions. <em>Science</em>
334: 232–235. <a href="https://doi.org/10.1126/science.1210657" class="external-link">doi.org/10.1126/science.1210657</a><br><br><a href="#bWatanabe">↑</a> <a name="refWatanabe"></a>Watanabe, S. 2013.
A widely applicable bayesian information criterion. <em>Journal of
Machine Learning Research</em> 14: 867–897. <a href="https://jmlr.org/papers/v14/watanabe13a.html" class="external-link">Link</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam Klimes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
